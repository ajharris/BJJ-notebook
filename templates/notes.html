{% extends "base.html" %}

{% block title %}BJJ Notebook - Notes{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ“ Training Notes</h1>
    <p>Manage your BJJ training notes</p>
</div>

<div class="notes-actions">
    <button type="button" class="btn btn-primary" onclick="showCreateNoteForm()">Create New Note</button>
    <input type="text" id="searchInput" class="search-input" placeholder="Search notes..." onkeyup="searchNotes()">
</div>

<div id="createNoteForm" class="note-form" style="display: none;">
    <h3>Create New Note</h3>
    <div class="form-group">
        <label for="noteTitle">Title:</label>
        <input type="text" id="noteTitle" class="form-control" placeholder="Enter note title">
    </div>
    <div class="form-group">
        <label for="noteContent">Content:</label>
        <textarea id="noteContent" class="form-control" rows="8" placeholder="Enter note content"></textarea>
    </div>
    <div class="form-group">
        <label for="noteTags">Tags (comma-separated):</label>
        <input type="text" id="noteTags" class="form-control" placeholder="e.g., guard, sweep, training">
    </div>
    <div class="form-actions">
        <button type="button" class="btn btn-primary" onclick="createNote()">Save Note</button>
        <button type="button" class="btn btn-secondary" onclick="hideCreateNoteForm()">Cancel</button>
    </div>
</div>

<div class="notes-list" id="notesList">
    {% if notes %}
        {% for note in notes %}
        <div class="note-card" data-note-title="{{ note.title|lower }}" data-note-tags="{{ note.tags|join(',')|lower }}">
            <div class="note-header">
                <h3>{{ note.title }}</h3>
                <div class="note-actions">
                    <a href="{{ url_for('view_note', note_id=note.id) }}" class="btn btn-sm btn-primary">View</a>
                    <button type="button" class="btn btn-sm btn-danger" onclick="deleteNote('{{ note.id }}')">Delete</button>
                </div>
            </div>
            <div class="note-meta">
                <span class="note-date">ğŸ“… {{ note.created_at[:10] }}</span>
                {% if note.tags %}
                <div class="note-tags">
                    {% for tag in note.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>ğŸ“ No notes yet. Create your first training note!</p>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function showCreateNoteForm() {
    document.getElementById('createNoteForm').style.display = 'block';
    document.getElementById('noteTitle').focus();
}

function hideCreateNoteForm() {
    document.getElementById('createNoteForm').style.display = 'none';
    document.getElementById('noteTitle').value = '';
    document.getElementById('noteContent').value = '';
    document.getElementById('noteTags').value = '';
}

async function createNote() {
    const title = document.getElementById('noteTitle').value.trim();
    const content = document.getElementById('noteContent').value.trim();
    const tags = document.getElementById('noteTags').value.trim();
    
    if (!title || !content) {
        alert('Title and content are required');
        return;
    }
    
    try {
        const response = await fetch('/api/notes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ title, content, tags })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Note saved successfully!');
            location.reload();
        } else {
            alert('Error: ' + data.error);
        }
    } catch (error) {
        alert('Error creating note: ' + error.message);
    }
}

async function deleteNote(noteId) {
    if (!confirm('Are you sure you want to delete this note?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/notes/${noteId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + data.error);
        }
    } catch (error) {
        alert('Error deleting note: ' + error.message);
    }
}

function searchNotes() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const noteCards = document.querySelectorAll('.note-card');
    
    noteCards.forEach(card => {
        const title = card.getAttribute('data-note-title');
        const tags = card.getAttribute('data-note-tags');
        const searchText = title + ' ' + tags;
        
        if (searchText.includes(searchTerm)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
